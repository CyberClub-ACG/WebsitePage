<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="" name="description">
    <link href="../img/other/cyberweb%20logo.png" rel="shortcut icon" type="image/jpg"/>
    <meta content="Alexandros Kourtis" name="author">
    <title>CyberWeb Dashboard</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">
    <meta content="#0275d8" name="theme-color">

    <link href="../css/custom.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/stylemembers.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        .modal .btn {
            color: white !important;
        }

        .toast {
            background: #0275d8 !important;
        }

        .dropdown-item {
            cursor: pointer;
        }

        .modal-dialog {
            max-width: 750px;
        }

        .mybtn {
            margin-right: 5px;
        }

        i {
            color: #212529 !important;
        }

        .btn {
            color: #212529 !important;
            border: 1px solid #212529 !important;
            margin: 5px
        }

        footer {
            position: absolute;
            z-index: 88888 !important;
            width: 100%;
        }

        .main {
            min-height: 100vh;
        }
    </style>
</head>

<body>
<div class="main">
    <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="./login.html">Cyber<span
                style="color: #0d6efd"><b>Web</b></span> Dashboard</a>
        <button aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation"
                class="navbar-toggler position-absolute d-md-none collapsed" data-bs-target="#sidebarMenu"
                data-bs-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <input aria-label="Search" class="form-control form-control-dark w-100" oninput="filter(event)"
               placeholder="Search" type="text">
        <ul class="navbar-nav px-3">
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="./login.html">Sign out</a>
            </li>
        </ul>
    </header>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse" id="sidebarMenu">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="./members.html">
                                <span data-feather="users"></span>
                                Club Members
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="./articles.html">
                                <span data-feather="file"></span>
                                Articles
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="spinner-border" id="myspinner" role="status" style="margin: 20px auto">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

                <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h3>Articles</h3>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead>
                        <tr>
                            <th>Image</th>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="writeArticlesHere">
                        </tbody>
                    </table>
                </div>
                <a href="newarticle.html">
                    <button class="btn btn-dark text-white" style="color: white !important">Add new</button>
                </a>
            </main>
            <!--report modal-->
            <div class="modal" id="myReportModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Save report</h5>
                            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                        </div>
                        <div class="modal-body">
                            <form class="needs-validation" novalidate>
                                <div class="row g-3">
                                    <div class="col-sm-6">
                                        <label class="form-label" for="title">Title</label>
                                        <input class="form-control" id="titlereport" placeholder="" required type="text"
                                               value="">
                                        <div class="invalid-feedback">
                                            title is required.
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                            <button class="btn btn-primary" onclick='exportToCSV()' type="button">Save changes</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--edit modal-->
            <div class="modal" id="myEditModal" tabindex="-1">
            </div>
            <!--view modal-->
            <div class="modal" id="myViewModal" tabindex="-1">
            </div>
        </div>
    </div>

    <div aria-atomic="true" aria-live="assertive"
         class="position-fixed toast align-items-center bottom-0 start-50 translate-middle-x text-white bg-primary border-0"
         id="toast" role="alert" style="margin-bottom: 20px">
        <div class="d-flex">
            <div class="toast-body">
            </div>
            <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    type="button"></button>
        </div>
    </div>

    <!--mydeletedialog-->
    <div class="modal" id="mydeletedialog" tabindex="-1">
    </div>
</div>
<footer class="site-footer">
    <div class="container" style="text-align: left ">
        <div class="row">
            <div class="col-sm-12 col-md-6">
                <h6>About</h6>
                <h5>The Cyber Club is open to all students who are interested in the IT
                    field. It aims to cultivate a community of motivated
                    individuals who are passionate about technology and want to enrich their academic and
                    student-life experience at Deree.</h5>
                <h5>Email: dc.cyberclub@acg.edu
                </h5>
                <h5>
                    Advisor: George Vardoulias
                </h5>
            </div>

            <div class="col-xs-6 col-md-3">
                <h6>Interests</h6>
                <ul class="footer-links">
                    <li>
                        <h5>Cybersecurity</h5>
                    </li>
                    <li>
                        <h5>Software Engineering</h5>
                    </li>
                    <li>
                        <h5>Machine Learning</h5>
                    </li>
                    <li>
                        <h5>Artificial
                            Intelligence</h5>
                    </li>
                    <li>
                        <h5>Operating Systems</h5>
                    </li>
                    <li>
                        <h5>Computer Networks</h5>
                    </li>
                    <li>
                        <h5>Telecommunications</h5>
                    </li>
                </ul>
            </div>

            <div class="col-xs-6 col-md-3">
                <h6>Skillset developed</h6>
                <ul class="footer-links">
                    <li>
                        <h5>Coding & Algorithms</h5>
                    </li>
                    <li>
                        <h5>Project Management</h5>
                    </li>
                    <li>
                        <h5>Public Speaking & Critical Thinking</h5>
                    </li>
                    <li>
                        <h5>Entrepreneurship</h5>
                    </li>
                    <li>
                        <h5>Research</h5>
                    </li>
                    <li>
                        <h5>Teamwork</h5>
                    </li>
                    <li>
                        <h5>Networking</h5>
                    </li>
                </ul>
            </div>
        </div>

        <br>
    </div>
    <div class="container">
        <div class="row" style="text-align: left ">
            <div class="col-md-10 col-sm-10 col-xs-10">
                <p class="copyright-text" style="float:left;">Copyright &copy; 2022 All Rights Reserved by
                    <a href="#">Cyber Club</a>. Reach out to us at: <a
                            href="mailto:dc.cyberclub@acg.edu">dc.cyberclub@acg.edu</a>.
                    <br><br>Secret portal: <a
                            href="../html/login.html">cyberweb</a>
                </p>
                <img alt="" src="../img/other/logo_trans.png"
                     style="float: right; width: 50px; height: 50px">

            </div>
        </div>
    </div>
</footer>
<script crossorigin="anonymous"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
        src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"></script>
<script type="text/javascript">


    function getKey() {
        if (!localStorage.getItem('secret')) {
            window.location.href = "login.html";
        }
    }

    getKey();

    'use strict'
    feather.replace();

    const state = {
        articles: [],
    }

    async function sortByDefault() {
        const sorted = state.articles.sort((a, b) => Date.parse(b.createdAt) - Date.parse(a.createdAt));
        await loadTable(sorted);
    }

    async function filter(event) {
        const keyword = event.target.value.toLowerCase().trim();
        const results = [];
        if (state.articles.length > 0) {
            state.articles.forEach(article => {
                if (article.title.toLowerCase().includes(keyword) || article.author.toLowerCase().includes(keyword)) {
                    results.push(article);
                }
            });

            await loadTable(results);
            hideLoading();
        }
    }

    function showLoading() {
        document.getElementById("myspinner").style.display = "block";
        document.getElementsByTagName("main")[0].style.display = "none";
    }

    function hideLoading() {
        document.getElementById("myspinner").style.display = "none";
        document.getElementsByTagName("main")[0].style.display = "block";
    }

    async function loadTable(payload) {
        document.getElementById("writeArticlesHere").innerHTML = "";
        payload.forEach(article => {
            document.getElementById("writeArticlesHere").innerHTML += "" +
                "<tr id='" + article._id + "'>\n" +
                "                        <td id='image'>" + "<img style='width: 70px' alt='...' class='card-img-top'\n" + "      src='https://mybucketkourtis.s3.eu-west-3.amazonaws.com/cyberclub/articles/" + article.imagefilename + "'></td>\n" +
                "                        <td id='studentid'>" + article.title + "</td>\n" +
                "                        <td  hidden id='id'>" + article._id + "</td>\n" +
                "                        <td id='articlename'>" + article.author + "</td>\n" +
                "                        <td> \n" +
                "                            <a target='_blank' class='bi bi-eye btn' style='font-size: 17px; cursor: pointer' href='https://frozen-citadel-66566.herokuapp.com/blog.html?title=" + article.titleslug + "'></a>\n" +
                "                            <a  class='bi bi-pencil btn' style='font-size: 17px; cursor: pointer' href='updatearticle.html?titleslug=" + article.titleslug + "'></a>\n" +
                "                            <i onclick='openDeleteDialog(\"" + article.title + "\", \"" + article._id + "\")' class=\"bi bi-trash btn\"\n" +
                "                               style=\"font-size: 17px; cursor: pointer\"></i>\n" +
                "                        </td>\n" +
                "                    </tr>"
        })
    }

    async function openDeleteDialog(title, id) {
        document.getElementById("mydeletedialog").innerHTML = "";
        document.getElementById("mydeletedialog").innerHTML += "<div>" +
            "        <form class=\"needs-validation\" novalidate>\n" +
            "            <div class=\"modal-dialog\">\n" +
            "                <div class=\"modal-content\">\n" +
            "                <div class=\"modal-header\">\n" +
            "                <h5 class=\"modal-title\">Deletion Confirmation </h5>\n" +
            "            <button aria-label=\"Close\" class=\"btn-close\" data-bs-dismiss=\"modal\" type=\"button\"></button>\n" +
            "                </div>\n" +
            "              <div class=\"modal-body\">\n" +
            "                <h6>Are you sure you want to proceed with the deletion? </h6>\n" +
            "                <div class=\"row g-3\">\n" +
            "                                <div class='col'>\n" +
            "                                     <label class='form-label form-control col-md-2' style='border: 0; float: left; padding-left: 5px; ' for='viewid'>Title:</label>\n" +
            "                                    <input disabled style='float: left' class='form-control col-md-10' id='viewid' placeholder='' value='" + title + "' required type='text'\n" +
            "                                           value=''>\n" +
            "                                    <div class='invalid-feedback'>\n" +
            "                                        Valid role is required.\n" +
            "                                    </div>\n" +
            "                                </div>\n" +
            "                                </div>\n" +
            "\n" +
            "            </div>\n" +
            "            <div class=\"modal-footer\">\n" +
            "                <button class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" type=\"button\">Cancel</button>\n <span hidden name='theid' id='theid'>" + id + "</span>" +
            "                <button class=\"btn btn-primary\" id=\"focusBtn\"  onclick='deleteArticle(event, \"" + id + "\", \"" + title + "\")' >Delete\n" +
            "                </button>\n" +
            "                </div>\n" +
            "                </div>\n" +
            "                </div>\n" +
            "                </div>\n" +
            "                </form></div>";

        $("#mydeletedialog").modal('show');
        $("#focusBtn").trigger('focus');
    }

    async function callback(payload) {
        state.articles = [];
        const data = JSON.parse(payload);
        await data.forEach(article => {
            if (article)
                state.articles.push(article);
        });

        await sortByDefault();
        hideLoading();
    }

    async function getRequest(params) {
        try {
            const options = {
                headers: {
                    'xapikey': localStorage.getItem('secret')
                }
            }
            const response = await fetch('https://cyberweb-backend.herokuapp.com/' + params, options);
            const data = await response.json();
            state.articles = [];
            await data.forEach(article => {
                if (article)
                    state.articles.push(article);
            });

            await sortByDefault();
            hideLoading();
        } catch (error) {
            console.log(error);
        }
    }

    function init() {
        showLoading();
        getArticles();
    }

    init();

    async function getArticles() {
        let params = "articles";
        await getRequest(params, callback);
        hideLoading();
    }

    function closeModal() {
        $(".modal").modal('hide');
        $(".modal-dialog").modal('hide');
    }

    $('#myModal').on('show.bs.modal', function (e) {
    });

    const options = {
        animation: true,
        autohide: true,
        delay: 2000
    }

    function showToast(text) {
        const toastEl = document.getElementById("toast");
        toastEl.getElementsByClassName("toast-body")[0].innerText = text;
        new bootstrap.Toast(toastEl, options).show();
    }

    async function deleteArticle(event, id, title) {
        event.preventDefault();

        try {
            await fetch("https://cyberweb-backend.herokuapp.com/articles/" + id, {
                method: "DELETE",
                headers: {
                    'xapikey': localStorage.getItem('secret'),
                },
            });
            showToast(title + " article has been deleted.");
            closeModal();
        } catch (err) {
            console.log(err);
        }
        await getArticles();
    }
</script>

</body>

</html>
